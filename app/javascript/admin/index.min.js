$( document ).on("turbolinks:load", function() {
  window.addEventListener('load', (event) => {
    var mess = document.querySelectorAll('.alert-message');
    for (let i = 0; i < mess.length; i++) {
      alertDone(I18n.alert.message, mess[i].innerHTML)
    }

    var success = document.querySelectorAll('.alert-success');
    for (let i = 0; i < success.length; i++) {
      toastr.success(success[i].innerHTML, "", {"closeButton": true})
    }

    var danger = document.querySelectorAll('.alert-danger');
    for (let i = 0; i < danger.length; i++) {
      toastr.error(danger[i].innerHTML, "", {"closeButton": true})
    }

    var infor = document.querySelectorAll('.alert-infor');
    for (let i = 0; i < infor.length; i++) {
      toastr.infor(infor[i].innerHTML, "", {"closeButton": true})
    }

    var warning = document.querySelectorAll('.alert-warning');
    for (let i = 0; i < warning.length; i++) {
      toastr.success(warning[i].innerHTML, "", {"closeButton": true})
    }

    $(".delete_category").on("click", function(){
      event.preventDefault();
      let urlRequest = $(this).data('url');
      let that = $(this);
      Swal.fire({
        title: I18n.alert.check1,
        text: I18n.alert.check,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: I18n.alert.yes_delete,
        cancelButtonText: I18n.alert.cancel
      }).then((result) => {
        if (result.value) {
          $.ajax({
            type: 'DELETE',
            dataType: 'json',
            url: urlRequest,
            success: function (data) {
              if (data.code == 200) {
                that.parent().parent().remove();
                alertSuccess(data.message);
              }
            },
            error: function () {
              alertError(data.message);
            }
          });
        }
      })
    })

    $(".show_user").on("click", function(){
      event.preventDefault();
      let urlRequest = $(this).data('url');
      let urlActivate = $(this).data('url-activate');
      $.ajax({
        type: 'GET',
        dataType: 'json',
        url: urlRequest,
        success: function (data) {
          if (data.code == 200) {
            $("#user_name").html(data.user.name)
            $("#user_email").html(data.user.email)
            $("#user_des").html(data.user.description)
            $("#user_url").data("url", urlActivate);
          }
        },
        error: function () {
          alertError(data.message);
        }
      })
    })

    $("#user_url").on("click", function(){
      event.preventDefault();
      let urlRequest = $(this).data('url');
      let that = $(this);
      $.ajax({
        type: 'PUT',
        dataType: 'json',
        url: urlRequest,
        success: function (data) {
          if (data.code == 200) {
            toastr.success(I18n.users.activate_ss, "", {"closeButton": true})
          }else{
            toastr.error(I18n.users.activate_ff, "", {"closeButton": true})
          }
        },
        error: function () {
          alertError(data.message);
        }
      })
    })

    $(".show_book").on("click", function(){
      event.preventDefault();
      $.ajax({
        type: 'GET',
        dataType: 'json',
        url: $(this).data('url_show_book'),
        success: function (data) {
          if (data.code == 200) {
            $("#book_name").html(data.user.name)
            $("#book_des").html(data.user.email)
            $("#book_image").html(data.user.description)
            $("#book_quantity").data("url", urlActivate)
            $("#book_author").data("url", urlActivate)
            $("#book_bupliser").data("url", urlActivate)
          }
        },
        error: function () {
          alertError(data.message);
        }
      })
    })

  });

  function alertDone(title,content){
    Swal.fire({
      title: title,
      html: '<b>'+content+'<b>',
      timerProgressBar: true,
      showCloseButton: true,
      timer: 4000,
      showCancelButton: true,
      focusConfirm: true,
    })
  }

  function alertError(){
    Swal.fire({
      icon: "Error",
      title: I18n.alert.error,
    })
  }

  function alertSuccess(message){
    Swal.fire(
      I18n.alert.delete_icon,
      message,
      'success'
    )
  }

});
